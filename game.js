var board=Array.from({length:10},()=>Array(10).fill("0")),clickedx=null,clickedy=null,theEvent=null,turn=1,round=1,hScore=0,mScore=0,treasure_count=0,playMode=!1,hAdded=!1,mAdded=!1,hunterX=null,hunterY=null,MonstersX=[],MonstersY=[],end=!1,killed=!1,current_monster=null,treasure_cell=[0,0],monstTo_t=null,bestT=0,noObstac=null;let directions1=[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]];function init(){for(h1.innerHTML="Setup",d1.innerHTML="Click a cell, then press 1-9 for treasure, 'h' for hunter, 'm' for monster, 'o' for obstacle",d2.innerHTML="press play when ready",x=0;x<board.length;x++){var e=document.createElement("tr");for(table.appendChild(e),y=0;y<board[x].length;y++){var n=document.createElement("td"),t=document.createTextNode(keyToImage(board[x][y]));n.appendChild(t),n.addEventListener("click",keyPress.bind(null,x,y),!1),e.appendChild(n)}}}function keyToImage(e){if("1"<=e&&e<="9")return"ðŸª™";switch(e){case"m":return"ðŸ‘¹";case"h":return"ðŸ¤ ";case"o":return"ðŸ§±";default:return""}}function keyPress(e,n,t){dw.style.display="none","0"!==board[e][n]?(dw.innerHTML="Grid position ["+e+","+n+"] already occupied",dw.style.display="block"):(clickedx=e,clickedy=n,theEvent=t)}function player_movement(e){updateStatus();let n=0,t=0;if("w"===e)n=-1;else if("s"===e)n=1;else if("a"===e)t=-1;else{if("d"!==e)return dw.innerHTML="Invalid key. Use W, A, S, or D",void(dw.style.display="block");t=1}var o,e=hunterX+n,d=hunterY+t;e<0||9<e||d<0||9<d?(dw.innerHTML="Move blocked! You can not go outside the grid",dw.style.display="block"):"m"===(o=board[e][d])?(board[hunterX][hunterY]="0",updateCell(hunterX,hunterY,""),updateCell(e,d,keyToImage("m")),dw.innerHTML="Game Over! You have been eating by a monster!",dw.style.display="block",killed=!0,endGame()):"o"===o?(dw.innerHTML="Obstacle! move has been blocked",dw.style.display="block",turn=2,setTimeout(moveMonsters,1250)):("1"<=o&&o<="9"&&(hScore+=parseInt(o),treasure_count--,updateStatus(),0==treasure_count)&&(end=!0),board[hunterX][hunterY]="0",board[e][d]="h",updateCell(hunterX,hunterY,""),updateCell(e,d,keyToImage("h")),hunterX=e,hunterY=d,dw.style.display="none",turn=2,(end?(dw.innerHTML="Game Over! There are no treasures left",dw.style.display="block",endGame):moveMonsters)())}function updateStatus(){document.getElementById("p1").innerHTML="Round - "+round,document.getElementById("p2").innerHTML="Your Score - "+hScore,document.getElementById("p3").innerHTML="Monster Score - "+mScore,document.getElementById("p4").innerHTML="Remaining Treasure - "+treasure_count}function updateCell(e,n,t){table.rows[e].cells[n].innerHTML=t}function moveMonsters(){mAdded&&2===turn&&(dw.style.display="none",setTimeout(()=>{round++,updateStatus(),dw.style.display="none",treasure_cell=[0,0],monstTo_t=null,bestT=0,noObstac=Array.from({length:MonstersX.length},()=>Array.from({length:8},()=>[0,0]));for(let e=0;e<MonstersX.length;e++){var n,t,o=MonstersX[e],d=MonstersY[e];c=0;for([n,t]of directions1){var r=o+n,l=d+t;if(0<=r&&r<=9&&0<=l&&l<=9){var s=board[r][l];if("h"===s)return board[o][d]="0",updateCell(o,d,""),updateCell(r,l,keyToImage("m")),dw.innerHTML="Game Over! You have been eating by a monster!",dw.style.display="block",killed=!0,void endGame();"1"<=s&&s<="9"&&bestT<s&&(bestT=s,treasure_cell=[r,l],monstTo_t=e),"o"!==s&&(noObstac[e][c]=[n,t],c++)}else c++}}moveMonsters2(),turn=1},500))}function moveMonsters2(){if(!two_cells_adjacent("h"))if(null!==monstTo_t){var e=MonstersX[monstTo_t],n=MonstersY[monstTo_t],t=treasure_cell[0],o=treasure_cell[1];if(board[e][n]="0",updateCell(e,n,""),updateCell(t,o,keyToImage(board[t][o]="m")),MonstersX[monstTo_t]=t,MonstersY[monstTo_t]=o,mScore+=parseInt(bestT),treasure_count--,updateStatus(),0==treasure_count)return dw.innerHTML="Game Over! There are no treasures left",dw.style.display="block",end=!0,void endGame()}else two_cells_adjacent("t")||choose_monster()}function two_cells_adjacent(e){let n=checkRegion([[-2,0]],[-1,0],e);return!!n||!!(n=(n=(n=(n=(n=(n=(n=checkRegion([[2,0]],[1,0],e))||checkRegion([[0,-2]],[0,-1],e))||checkRegion([[0,2]],[0,1],e))||checkRegion([[-2,-2],[-1,-2],[-2,-1]],[-1,-1],e))||checkRegion([[1,-2],[2,-2],[2,-1]],[1,-1],e))||checkRegion([[-2,1],[-2,2],[-1,2]],[-1,1],e))||checkRegion([[2,1],[2,2],[1,2]],[1,1],e))}function checkRegion(n,t,o){for(let e=0;e<MonstersX.length;e++){var d,r,l=MonstersX[e],s=MonstersY[e];for([d,r]of n){var a=l+d,c=s+r;if(!(a<0||9<a||c<0||9<c)){a=board[a][c];if("h"===o&&"h"===a||"t"===o&&"1"<=a&&a<="9"){c=l+t[0],a=s+t[1];if("o"!==board[c][a])return board[l][s]="0",updateCell(l,s,""),updateCell(c,a,keyToImage(board[c][a]="m")),MonstersX[e]=c,MonstersY[e]=a,!0}}}}return!1}function choose_monster(){i=current_monster;let n=!1;shuffle(noObstac[i]);for(var[e,t]of noObstac[i])if(0!==e||0!==t){moveMonsters3(i,e,t),n=!0;break}if(!n)for(let e=0;e<noObstac.length;e++)if(e!==i){shuffle(noObstac[e]);for(var[o,d]of noObstac[e])if(0!==o||0!==d){moveMonsters3(e,o,d),n=!0;break}if(n)break}++current_monster>=MonstersX.length&&(current_monster=0)}function shuffle(n){for(let e=n.length-1;0<e;e--){var t=Math.floor(Math.random()*(e+1));[n[e],n[t]]=[n[t],n[e]]}}function moveMonsters3(e,n,t){var o=MonstersX[e],d=MonstersY[e],n=o+n,t=d+t;n<0||9<n||t<0||9<t||(board[o][d]="0",updateCell(o,d,""),updateCell(n,t,keyToImage(board[n][t]="m")),MonstersX[e]=n,MonstersY[e]=t)}function play(){hAdded?(playMode=!0,mAdded&&(current_monster=0),h1.style.display="none",d1.style.display="none",d2.style.display="none",dw.style.display="none",document.getElementById("Play").style.display="none",document.getElementById("end").style.display="block",updateStatus(),0==treasure_count&&endGame()):(dw.innerHTML="Please add an hunter to a cell before continuing",dw.style.display="block")}function endGame(){playMode=!1,setTimeout(()=>{dw.style.display="none",table.innerHTML="",table.style.display="none",h1.innerHTML="Game Over",h1.style.display="block",killed&&(document.getElementById("e1").innerHTML="You lose"),end&&(document.getElementById("e1").innerHTML=mScore<hScore?"YOU WIN!!!":hScore<mScore?"You lose":"Draw"),document.getElementById("e1").style.display="block",document.getElementById("e2").innerHTML="Rounds - "+round,document.getElementById("e2").style.display="block",document.getElementById("e3").innerHTML="Your Scrore - "+hScore,document.getElementById("e3").style.display="block",document.getElementById("e4").innerHTML="Monster's Score - "+mScore,document.getElementById("e4").style.display="block",document.getElementById("end").style.display="none",document.getElementById("newGame").style.display="block",document.getElementById("p1").innerHTML="",document.getElementById("p2").innerHTML="",document.getElementById("p3").innerHTML="",document.getElementById("p4").innerHTML=""},3e3)}function resetGame(){board=Array.from({length:10},()=>Array(10).fill("0")),mAdded=hAdded=playMode=!(round=turn=1),MonstersX=[],MonstersY=[],bestT=treasure_count=mScore=hScore=0,noObstac=monstTo_t=current_monster=hunterY=hunterX=theEvent=clickedy=clickedx=null,killed=end=!(treasure_cell=[0,0]),document.getElementById("e1").innerHTML="",document.getElementById("e2").innerHTML="",document.getElementById("e3").innerHTML="",document.getElementById("e4").innerHTML="",document.getElementById("e1").style.display="none",document.getElementById("e2").style.display="none",document.getElementById("e3").style.display="none",document.getElementById("e4").innerHTML="",document.getElementById("Play").style.display="block",document.getElementById("end").style.display="none",document.getElementById("newGame").style.display="none",table.style.display="block",init()}document.addEventListener("keydown",e=>{e=e.key.toLowerCase();if(playMode)1===turn&&player_movement(e);else if(null!==clickedx&&null!==clickedy)if("1"<=e&&e<="9"||["h","m","o"].includes(e)){if("1"<=e&&e<="9"&&treasure_count++,"h"===e){if(hAdded)return dw.innerHTML="Only one hunter can be added to the game",void(dw.style.display="block");hAdded=!0,hunterX=clickedx,hunterY=clickedy}"m"===e&&(mAdded=!0,MonstersX.push(clickedx),MonstersY.push(clickedy)),"o"===e&&(oAdded=!0),dw.style.display="none",board[clickedx][clickedy]=e,theEvent.target.innerHTML=keyToImage(e),clickedy=clickedx=null}else dw.innerHTML="Enter a valid key",dw.style.display="block"});let h1=document.getElementById("h1"),d1=document.getElementById("d1"),d2=document.getElementById("d2"),dw=document.getElementById("dw"),table=document.getElementById("t1");init();
